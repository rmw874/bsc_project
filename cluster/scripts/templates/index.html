
<!DOCTYPE html>
<html>
<head>
    <title>OCR Labeling Tool</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .image-container { margin: 20px 0; text-align: center; }
        img { max-width: 100%; max-height: 400px; }
        .controls { display: flex; gap: 10px; margin: 20px 0; }
        input[type="text"] { flex-grow: 1; padding: 5px; font-size: 16px; }
        button { padding: 5px 15px; cursor: pointer; }
        .metadata { color: #666; margin: 10px 0; }
        .progress { margin: 10px 0; }
        .keyboard-hints {
            background: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>OCR Labeling Tool</h1>
    
    <div class="keyboard-hints">
        <strong>Keyboard shortcuts:</strong><br>
        Enter - Save and next image<br>
        Left Arrow - Previous image<br>
        Right Arrow - Next image
    </div>
    
    <div class="progress">
        Image <span id="current">0</span> of <span id="total">0</span>
    </div>
    
    <div class="metadata" id="metadata"></div>
    
    <div class="image-container">
        <img id="current-image" src="" alt="Current image">
    </div>
    
    <div class="controls">
        <button onclick="prevImage()">&lt; Previous</button>
        <input type="text" id="text-input" placeholder="Enter text...">
        <button onclick="nextImage()">Next &gt;</button>
        <button onclick="saveAndNext()">Save & Next</button>
    </div>
    
    <script>
        let currentIdx = 0;
        let currentFilename = '';
        
        async function loadImage(idx) {
            const response = await fetch(`/info/${idx}`);
            if (response.ok) {
                const info = await response.json();
                currentFilename = info.filename;
                
                document.getElementById('current-image').src = `/image/${idx}`;
                document.getElementById('text-input').value = info.current_text;
                document.getElementById('current').textContent = idx + 1;
                document.getElementById('total').textContent = info.total_images;
                
                // Display metadata
                const metadata = info.metadata;
                let metadataText = '';
                if (metadata.source_image) {
                    metadataText += `Source: ${metadata.source_image} | `;
                }
                if (metadata.column !== undefined) {
                    metadataText += `Column: ${metadata.column} | `;
                }
                if (metadata.row !== undefined) {
                    metadataText += `Row: ${metadata.row}`;
                }
                document.getElementById('metadata').textContent = metadataText;
                
                document.getElementById('text-input').focus();
            }
        }
        
        async function saveAnnotation() {
            const text = document.getElementById('text-input').value;
            const response = await fetch('/save', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    filename: currentFilename,
                    text: text
                })
            });
            return response.ok;
        }
        
        async function saveAndNext() {
            if (await saveAnnotation()) {
                nextImage();
            }
        }
        
        function prevImage() {
            if (currentIdx > 0) {
                currentIdx--;
                loadImage(currentIdx);
            }
        }
        
        function nextImage() {
            currentIdx++;
            loadImage(currentIdx);
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', async function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                await saveAndNext();
            } else if (e.key === 'ArrowLeft') {
                prevImage();
            } else if (e.key === 'ArrowRight') {
                nextImage();
            }
        });
        
        // Load first image on start
        loadImage(0);
    </script>
</body>
</html>
    